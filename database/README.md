# Banco de Dados - Firebird 5.0

Este diret√≥rio cont√©m toda a estrutura de conex√£o e modelos para o banco de dados Firebird 5.0.

## üìÅ Estrutura de Arquivos

```
database/
‚îú‚îÄ‚îÄ __init__.py              # M√≥dulo Python
‚îú‚îÄ‚îÄ config.py                # Configura√ß√µes do banco
‚îú‚îÄ‚îÄ connection.py            # Classe de conex√£o
‚îú‚îÄ‚îÄ models.py                # Modelos de dados
‚îú‚îÄ‚îÄ test_connection.py       # Script de teste
‚îú‚îÄ‚îÄ README.md               # Este arquivo
‚îú‚îÄ‚îÄ estrutura.sql           # Script de cria√ß√£o da tabela
‚îî‚îÄ‚îÄ MDWVALIDACAO.FDB       # Arquivo do banco Firebird
```

## üîß Configura√ß√£o

### Pr√©-requisitos

1. **Firebird 5.0** instalado e rodando
2. **Driver Python firebird-driver** instalado: `pip install firebird-driver`
3. **Arquivo MDWVALIDACAO.FDB** presente no diret√≥rio

### Configura√ß√µes Padr√£o

- **Host**: localhost
- **Porta**: 3050
- **Usu√°rio**: SYSDBA
- **Senha**: masterkey
- **Charset**: UTF8

### Vari√°veis de Ambiente

Para produ√ß√£o, voc√™ pode configurar via vari√°veis de ambiente:

```bash
export FLASK_ENV=production
export DB_HOST=seu_servidor
export DB_PORT=3050
export DB_USER=seu_usuario
export DB_PASSWORD=sua_senha
export DB_PATH=caminho/para/MDWVALIDACAO.FDB
```

## üóÑÔ∏è Estrutura da Tabela

```sql
CREATE TABLE VALIDACOES (
    ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TIPO_VALIDACAO VARCHAR(50),
    RESULTADO BLOB SUB_TYPE TEXT,
    DATA_VALIDACAO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    NOME_ARQUIVO VARCHAR(255)
);
```

### Campos

- **ID**: Chave prim√°ria auto-incremento
- **TIPO_VALIDACAO**: Tipo da valida√ß√£o (html, sql, executeblock, csharp, validacao_manual)
- **RESULTADO**: JSON com os resultados da valida√ß√£o
- **DATA_VALIDACAO**: Timestamp da valida√ß√£o
- **NOME_ARQUIVO**: Nome do arquivo validado

## üöÄ Como Usar

### Importar o m√≥dulo

```python
from database import Validacao, db_connection
```

### Testar conex√£o

```python
python database/test_connection.py
```

### Salvar valida√ß√£o autom√°tica

```python
validacao = Validacao()
resultado = {
    'erros': ['Erro 1', 'Erro 2'],
    'status': 'com_erros'
}
validacao.salvar_validacao_automatica('html', resultado, 'arquivo.html')
```

### Salvar valida√ß√£o manual

```python
checklist = {
    'sec1_1': True,
    'sec1_2': False,
    'sec2_1': True
}
validacao.salvar_validacao_manual(checklist, 'arquivo.html')
```

### Buscar valida√ß√µes

```python
validacoes = validacao.buscar_validacoes(limit=10, offset=0)
```

## üîç Troubleshooting

### Erro de conex√£o

1. Verifique se o Firebird est√° rodando
2. Confirme as credenciais (SYSDBA/masterkey)
3. Verifique se o arquivo .FDB existe
4. Teste com o script: `python database/test_connection.py`

### Erro de driver

```bash
pip install firebird-driver==1.0.0
```

### Erro de permiss√£o

Certifique-se de que o usu√°rio tem permiss√£o para:
- Conectar ao banco
- Executar SELECT, INSERT, UPDATE, DELETE
- Acessar a tabela VALIDACOES

## üìä Exemplos de Dados

### Valida√ß√£o Autom√°tica
```json
{
    "erros": ["Tag HTML n√£o encontrada", "CSS conflitante"],
    "status": "com_erros",
    "arquivo": "laudo.html"
}
```

### Valida√ß√£o Manual
```json
{
    "tipo": "validacao_manual",
    "checklist": {
        "sec1_1": true,
        "sec1_2": false,
        "sec2_1": true
    },
    "status": "completo"
}
```

## üîÑ Migra√ß√£o do Driver Antigo

Se voc√™ estava usando o driver `fdb` antigo, as principais mudan√ßas s√£o:

### Antes (fdb):
```python
import fdb
```

### Agora (firebird-driver):
```python
import firebird.driver as fdb
```

### Benef√≠cios do Novo Driver:
- ‚úÖ Melhor performance
- ‚úÖ Suporte oficial do Firebird
- ‚úÖ Compatibilidade com Firebird 5.0
- ‚úÖ Melhor tratamento de erros
- ‚úÖ Documenta√ß√£o mais completa 